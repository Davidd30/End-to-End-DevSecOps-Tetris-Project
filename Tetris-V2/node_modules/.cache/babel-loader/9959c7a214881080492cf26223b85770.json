{"ast":null,"code":"import _objectSpread from\"/Users/davidnabilgerges/Downloads/End-to-End-DevSecOps-Tetris-Project/End-to-End-DevSecOps-Tetris-Project/Tetris-V2/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/Users/davidnabilgerges/Downloads/End-to-End-DevSecOps-Tetris-Project/End-to-End-DevSecOps-Tetris-Project/Tetris-V2/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _toConsumableArray from\"/Users/davidnabilgerges/Downloads/End-to-End-DevSecOps-Tetris-Project/End-to-End-DevSecOps-Tetris-Project/Tetris-V2/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import React,{useState,useEffect}from\"react\";import{useDrag}from\"react-use-gesture\";import BarLoader from\"react-spinners/BarLoader\";import Stage from\"../Stage\";import{useInterval}from\"../../hooks/useInterval\";import Center from\"../Center\";import{PrintPlayerInMap}from\"../../utils/Utils\";//TODO: Alterar OnClick (rotatePlayer) para OnFastClick (criar hook)\n//TODO: Organização do componente \"Game\" (Separar codigo em hooks, outros components e funcoes)\n//TODO: Dar um tempo quando o bloco estiver no chão, mas o usuário mexendo\nvar STAGE_HEIGHT=18;var STAGE_WIDTH=10;var initialMap=_toConsumableArray(new Array(STAGE_HEIGHT)).map(function(){return _toConsumableArray(new Array(STAGE_WIDTH)).map(function(){return{fill:0,color:[]};});});var colors=[\"#e54b4b\",\"#9a031e\",\"#fcdc4d\",\"#005397\",\"#0bbcd6\",\"#20ad65\",\"#f8ebee\"];var I={bloco:[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]]};var O={bloco:[[1,1],[1,1]]};var T={bloco:[[0,0,0],[1,1,1],[0,1,0]]};var J={bloco:[[0,1,0],[0,1,0],[1,1,0]]};var L={bloco:[[0,1,0],[0,1,0],[0,1,1]]};var S={bloco:[[0,1,1],[1,1,0],[0,0,0]]};var Z={bloco:[[1,1,0],[0,1,1],[0,0,0]]};var getRandomBloco=function getRandomBloco(){var blocos=[I,O,T,J,L,S,Z];var bloco=blocos[Math.floor(Math.random()*blocos.length)];bloco.color=colors[Math.floor(Math.random()*colors.length)];return bloco;};var getRandomPlayer=function getRandomPlayer(player){var bloco,next;if(player)if(player.next){bloco=JSON.parse(JSON.stringify(player.next));next=getRandomBloco();}if(!bloco)bloco=getRandomBloco();if(!next)next=getRandomBloco();var pos=[0,Math.floor(STAGE_WIDTH/2-2/2)];return{pos:pos,bloco:bloco,next:next};};var Game=function Game(){var _useState=useState(initialMap),_useState2=_slicedToArray(_useState,2),map=_useState2[0],setMap=_useState2[1];var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),player=_useState4[0],setPlayer=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),down=_useState6[0],setDown=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),pause=_useState8[0],setPause=_useState8[1];var _useState9=useState(Date.now()),_useState10=_slicedToArray(_useState9,2),tick=_useState10[0],setTick=_useState10[1];var _useState11=useState(),_useState12=_slicedToArray(_useState11,2),hintPlayer=_useState12[0],setHintPlayer=_useState12[1];var _useState13=useState(true),_useState14=_slicedToArray(_useState13,2),spaceReleased=_useState14[0],setSpaceReleased=_useState14[1];var _useState15=useState(0),_useState16=_slicedToArray(_useState15,2),lines=_useState16[0],setlines=_useState16[1];var _useState17=useState(0),_useState18=_slicedToArray(_useState17,2),score=_useState18[0],setScore=_useState18[1];var _useState19=useState(1),_useState20=_slicedToArray(_useState19,2),level=_useState20[0],setLevel=_useState20[1];var _useState21=useState(0),_useState22=_slicedToArray(_useState21,2),dragX=_useState22[0],setDragX=_useState22[1];var _useState23=useState(0),_useState24=_slicedToArray(_useState23,2),dragY=_useState24[0],setDragY=_useState24[1];var _useState25=useState(false),_useState26=_slicedToArray(_useState25,2),gameOver=_useState26[0],setGameOver=_useState26[1];useEffect(function(){var levelBaseScore=1000;var nextLevel=level+1;var nextLevelScore=levelBaseScore*nextLevel*nextLevel*nextLevel/5;console.log(\"Current level: \",level);console.log(\"Score to next level:\",nextLevelScore);console.log(\"Remaining: \",nextLevelScore-score);if(score>=nextLevelScore)setLevel(level+1);},[level,score]);var restartGame=function restartGame(){setMap(initialMap);//TODO: lose game\nsetlines(0);setScore(0);setLevel(1);setGameOver(false);};var loseGame=function loseGame(){setGameOver(true);};var drop=function drop(){if(!player){setPlayer(getRandomPlayer());return;}setPlayer(function(player){var newPos=getNewPlayerPos(\"down\");if(player.pos===newPos){setMap(function(map){var mapWithPlayer=PrintPlayerInMap(player,map);var mapCleared=checkMap(mapWithPlayer);return mapCleared;});var newPlayer=getRandomPlayer(player);if(!validatePosition(newPlayer.pos,newPlayer.bloco))loseGame();return newPlayer;}return _objectSpread({},player,{pos:newPos});});};var rotatePlayer=function rotatePlayer(){var clonedPlayer=JSON.parse(JSON.stringify(player));var mtrx=clonedPlayer.bloco.bloco.map(function(_,index){return clonedPlayer.bloco.bloco.map(function(column){return column[index];});});mtrx=mtrx.map(function(row){return row.reverse();});if(validatePosition(player.pos,{bloco:mtrx}))setPlayer(_objectSpread({},player,{bloco:_objectSpread({},player.bloco,{bloco:mtrx})}));};var keyUp=function keyUp(_ref){var keyCode=_ref.keyCode;if(pause||gameOver)return;var THRESHOLD=80;// Activate the interval again when user releases down arrow.\nif(keyCode===40){setDown(false);if(Date.now()-tick<=THRESHOLD)drop();}if(keyCode===32)setSpaceReleased(true);};var forwardDown=function forwardDown(){if(pause||gameOver)return;setPlayer(function(player){var playerCopy=JSON.parse(JSON.stringify(player));playerCopy.pos=_toConsumableArray(hintPlayer.pos);setMap(function(map){var mapWithPlayer=PrintPlayerInMap(playerCopy,map);var mapCleared=checkMap(mapWithPlayer);return mapCleared;});var newPlayer=getRandomPlayer(player);if(!validatePosition(newPlayer.pos,newPlayer.bloco))loseGame();return newPlayer;});};var keyDown=function keyDown(_ref2){var keyCode=_ref2.keyCode;if(pause||gameOver)return;switch(keyCode){case 37:setPlayer(function(player){return _objectSpread({},player,{pos:getNewPlayerPos(\"left\")});});break;case 38:rotatePlayer();break;case 39:setPlayer(function(player){return _objectSpread({},player,{pos:getNewPlayerPos(\"right\")});});break;case 40:setTick(Date.now());setDown(true);break;case 32:if(spaceReleased){setSpaceReleased(false);forwardDown();}break;default:break;}};var checkMap=React.useCallback(function(map){var rowsClear=[];map.forEach(function(row,y){var clear=true;row.forEach(function(pixel,x){if(pixel.fill===0)clear=false;});if(clear)rowsClear.push(y);});if(rowsClear.length>0){var newMap=map.slice();rowsClear.forEach(function(y){for(var mapY=newMap.length-1;mapY>=0;mapY--){if(mapY<=y)if(mapY>0)newMap[mapY]=newMap[mapY-1];else newMap[mapY]=_toConsumableArray(new Array(STAGE_WIDTH)).map(function(){return{fill:0,color:[]};});}});setlines(function(quant){return quant+rowsClear.length;});var bonusLevel=100*(level*level);var bonusRows=40*(rowsClear.length*rowsClear.length-1);setScore(function(score){return score+300*rowsClear.length+bonusRows+bonusLevel;});return newMap;}return map;},[level]);var validatePosition=React.useCallback(function(pos,bloco){for(var y=0;y<bloco.bloco.length;y++){for(var x=0;x<bloco.bloco[y].length;x++){if(bloco.bloco[y][x]===1){var mapY=pos[0]+y;var mapX=pos[1]+x;if(mapY>STAGE_HEIGHT||mapX<0||mapX>STAGE_WIDTH||!map[mapY]||!map[mapY][mapX]||map[mapY][mapX].fill===1)return false;}}}return true;},[map]);var calculateHintPlayer=React.useCallback(function(player){var hintBloco=JSON.parse(JSON.stringify(player.bloco));var hintPosition=_toConsumableArray(player.pos);while(validatePosition([hintPosition[0]+1,hintPosition[1]],hintBloco)){hintPosition=[hintPosition[0]+1,hintPosition[1]];}return{pos:hintPosition,bloco:hintBloco};},[validatePosition]);var getNewPlayerPos=React.useCallback(function(movement){var newPos;if(!player)return;if(movement===\"down\")newPos=[player.pos[0]+1,player.pos[1]];if(movement===\"left\")newPos=[player.pos[0],player.pos[1]-1];if(movement===\"right\")newPos=[player.pos[0],player.pos[1]+1];if(!validatePosition(newPos,player.bloco))return player.pos;return newPos;},[player,validatePosition]);useInterval(function(){drop();},pause||gameOver?null:down?50:450-(level-1)*20);useEffect(function(){if(!player)return;setHintPlayer(calculateHintPlayer(player));},[player,calculateHintPlayer]);var bind=useDrag(function(_ref3){var down=_ref3.down,_ref3$movement=_slicedToArray(_ref3.movement,2),mx=_ref3$movement[0],my=_ref3$movement[1],velocity=_ref3.velocity;var THRESHOLD=20;var FORCE_THRESHOLD=1;if(down){if(Math.abs(mx-dragX)>THRESHOLD){if(mx-dragX>0)setPlayer(function(player){return _objectSpread({},player,{pos:getNewPlayerPos(\"right\")});});else setPlayer(function(player){return _objectSpread({},player,{pos:getNewPlayerPos(\"left\")});});setDragX(mx);}if(Math.abs(my-dragY)>THRESHOLD){if(velocity>FORCE_THRESHOLD){if(spaceReleased){setSpaceReleased(false);forwardDown();}}else if(my-dragY>0)drop();setDragY(my);}}else{setDragX(0);setDragY(0);setSpaceReleased(true);}},{filterTaps:true,lockDirection:true});if(!player||!map||!hintPlayer)return React.createElement(Center,null,React.createElement(BarLoader,{color:\"#C41212\"}));return React.createElement(Stage,Object.assign({lose:gameOver,restartClick:function restartClick(){return restartGame();},map:map,player:player,hint:hintPlayer,paused:pause,status:{lines:lines,score:score,level:level},onBlur:function onBlur(){return setPause(true);},onFocus:function onFocus(){return setPause(false);},tabIndex:\"0\",onKeyUp:keyUp,onKeyDown:keyDown,onClick:function onClick(){return rotatePlayer();}},bind()));};export default Game;","map":{"version":3,"sources":["/Users/davidnabilgerges/Downloads/End-to-End-DevSecOps-Tetris-Project/End-to-End-DevSecOps-Tetris-Project/Tetris-V2/src/components/Game/index.js"],"names":["React","useState","useEffect","useDrag","BarLoader","Stage","useInterval","Center","PrintPlayerInMap","STAGE_HEIGHT","STAGE_WIDTH","initialMap","Array","map","fill","color","colors","I","bloco","O","T","J","L","S","Z","getRandomBloco","blocos","Math","floor","random","length","getRandomPlayer","player","next","JSON","parse","stringify","pos","Game","setMap","setPlayer","down","setDown","pause","setPause","Date","now","tick","setTick","hintPlayer","setHintPlayer","spaceReleased","setSpaceReleased","lines","setlines","score","setScore","level","setLevel","dragX","setDragX","dragY","setDragY","gameOver","setGameOver","levelBaseScore","nextLevel","nextLevelScore","console","log","restartGame","loseGame","drop","newPos","getNewPlayerPos","mapWithPlayer","mapCleared","checkMap","newPlayer","validatePosition","rotatePlayer","clonedPlayer","mtrx","_","index","column","row","reverse","keyUp","keyCode","THRESHOLD","forwardDown","playerCopy","keyDown","useCallback","rowsClear","forEach","y","clear","pixel","x","push","newMap","slice","mapY","quant","bonusLevel","bonusRows","mapX","calculateHintPlayer","hintBloco","hintPosition","movement","bind","mx","my","velocity","FORCE_THRESHOLD","abs","filterTaps","lockDirection"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport { useDrag } from \"react-use-gesture\";\nimport BarLoader from \"react-spinners/BarLoader\";\n\nimport Stage from \"../Stage\";\nimport { useInterval } from \"../../hooks/useInterval\";\nimport Center from \"../Center\";\n\nimport { PrintPlayerInMap } from \"../../utils/Utils\";\n\n//TODO: Alterar OnClick (rotatePlayer) para OnFastClick (criar hook)\n//TODO: Organização do componente \"Game\" (Separar codigo em hooks, outros components e funcoes)\n//TODO: Dar um tempo quando o bloco estiver no chão, mas o usuário mexendo\n\nconst STAGE_HEIGHT = 18;\nconst STAGE_WIDTH = 10;\n\nconst initialMap = [...new Array(STAGE_HEIGHT)].map(() =>\n\t[...new Array(STAGE_WIDTH)].map(() => ({ fill: 0, color: [] }))\n);\n\nconst colors = [\n\t\"#e54b4b\",\n\t\"#9a031e\",\n\t\"#fcdc4d\",\n\t\"#005397\",\n\t\"#0bbcd6\",\n\t\"#20ad65\",\n\t\"#f8ebee\"\n];\n\nconst I = {\n\tbloco: [\n\t\t[0, 0, 0, 0],\n\t\t[1, 1, 1, 1],\n\t\t[0, 0, 0, 0],\n\t\t[0, 0, 0, 0]\n\t]\n};\n\nconst O = {\n\tbloco: [\n\t\t[1, 1],\n\t\t[1, 1]\n\t]\n};\n\nconst T = {\n\tbloco: [\n\t\t[0, 0, 0],\n\t\t[1, 1, 1],\n\t\t[0, 1, 0]\n\t]\n};\n\nconst J = {\n\tbloco: [\n\t\t[0, 1, 0],\n\t\t[0, 1, 0],\n\t\t[1, 1, 0]\n\t]\n};\n\nconst L = {\n\tbloco: [\n\t\t[0, 1, 0],\n\t\t[0, 1, 0],\n\t\t[0, 1, 1]\n\t]\n};\n\nconst S = {\n\tbloco: [\n\t\t[0, 1, 1],\n\t\t[1, 1, 0],\n\t\t[0, 0, 0]\n\t]\n};\n\nconst Z = {\n\tbloco: [\n\t\t[1, 1, 0],\n\t\t[0, 1, 1],\n\t\t[0, 0, 0]\n\t]\n};\n\nconst getRandomBloco = () => {\n\tconst blocos = [I, O, T, J, L, S, Z];\n\tconst bloco = blocos[Math.floor(Math.random() * blocos.length)];\n\tbloco.color = colors[Math.floor(Math.random() * colors.length)];\n\treturn bloco;\n};\nconst getRandomPlayer = player => {\n\tlet bloco, next;\n\tif (player)\n\t\tif (player.next) {\n\t\t\tbloco = JSON.parse(JSON.stringify(player.next));\n\t\t\tnext = getRandomBloco();\n\t\t}\n\tif (!bloco) bloco = getRandomBloco();\n\tif (!next) next = getRandomBloco();\n\tconst pos = [0, Math.floor(STAGE_WIDTH / 2 - 2 / 2)];\n\treturn { pos, bloco, next };\n};\n\nconst Game = () => {\n\tconst [map, setMap] = useState(initialMap);\n\tconst [player, setPlayer] = useState();\n\tconst [down, setDown] = useState(false);\n\tconst [pause, setPause] = useState(false);\n\tconst [tick, setTick] = useState(Date.now());\n\tconst [hintPlayer, setHintPlayer] = useState();\n\tconst [spaceReleased, setSpaceReleased] = useState(true);\n\tconst [lines, setlines] = useState(0);\n\tconst [score, setScore] = useState(0);\n\tconst [level, setLevel] = useState(1);\n\tconst [dragX, setDragX] = useState(0);\n\tconst [dragY, setDragY] = useState(0);\n\tconst [gameOver, setGameOver] = useState(false);\n\n\tuseEffect(() => {\n\t\tconst levelBaseScore = 1000;\n\t\tconst nextLevel = level + 1;\n\t\tconst nextLevelScore =\n\t\t\t(levelBaseScore * nextLevel * nextLevel * nextLevel) / 5;\n\t\tconsole.log(\"Current level: \", level);\n\t\tconsole.log(\"Score to next level:\", nextLevelScore);\n\t\tconsole.log(\"Remaining: \", nextLevelScore - score);\n\t\tif (score >= nextLevelScore) setLevel(level + 1);\n\t}, [level, score]);\n\n\tconst restartGame = () => {\n\t\tsetMap(initialMap); //TODO: lose game\n\t\tsetlines(0);\n\t\tsetScore(0);\n\t\tsetLevel(1);\n\t\tsetGameOver(false);\n\t}\n\n\tconst loseGame = () => {\n\t\tsetGameOver(true);\n\t};\n\n\tconst drop = () => {\n\t\tif (!player) {\n\t\t\tsetPlayer(getRandomPlayer());\n\t\t\treturn;\n\t\t}\n\t\tsetPlayer(player => {\n\t\t\tconst newPos = getNewPlayerPos(\"down\");\n\t\t\tif (player.pos === newPos) {\n\t\t\t\tsetMap(map => {\n\t\t\t\t\tconst mapWithPlayer = PrintPlayerInMap(player, map);\n\t\t\t\t\tconst mapCleared = checkMap(mapWithPlayer);\n\t\t\t\t\treturn mapCleared;\n\t\t\t\t});\n\t\t\t\tconst newPlayer = getRandomPlayer(player);\n\t\t\t\tif (!validatePosition(newPlayer.pos, newPlayer.bloco)) loseGame();\n\t\t\t\treturn newPlayer;\n\t\t\t}\n\t\t\treturn { ...player, pos: newPos };\n\t\t});\n\t};\n\n\tconst rotatePlayer = () => {\n\t\tconst clonedPlayer = JSON.parse(JSON.stringify(player));\n\t\tlet mtrx = clonedPlayer.bloco.bloco.map((_, index) =>\n\t\t\tclonedPlayer.bloco.bloco.map(column => column[index])\n\t\t);\n\t\tmtrx = mtrx.map(row => row.reverse());\n\t\tif (validatePosition(player.pos, { bloco: mtrx }))\n\t\t\tsetPlayer({ ...player, bloco: { ...player.bloco, bloco: mtrx } });\n\t};\n\n\tconst keyUp = ({ keyCode }) => {\n\t\tif (pause || gameOver)\n\t\t\treturn;\n\t\tconst THRESHOLD = 80;\n\t\t// Activate the interval again when user releases down arrow.\n\t\tif (keyCode === 40) {\n\t\t\tsetDown(false);\n\t\t\tif (Date.now() - tick <= THRESHOLD) drop();\n\t\t}\n\t\tif (keyCode === 32) setSpaceReleased(true);\n\t};\n\n\tconst forwardDown = () => {\n\t\tif (pause || gameOver)\n\t\t\treturn;\n\t\tsetPlayer(player => {\n\t\t\tconst playerCopy = JSON.parse(JSON.stringify(player));\n\t\t\tplayerCopy.pos = [...hintPlayer.pos];\n\t\t\tsetMap(map => {\n\t\t\t\tconst mapWithPlayer = PrintPlayerInMap(playerCopy, map);\n\t\t\t\tconst mapCleared = checkMap(mapWithPlayer);\n\t\t\t\treturn mapCleared;\n\t\t\t});\n\t\t\tconst newPlayer = getRandomPlayer(player);\n\t\t\tif (!validatePosition(newPlayer.pos, newPlayer.bloco)) loseGame();\n\t\t\treturn newPlayer;\n\t\t});\n\t};\n\n\tconst keyDown = ({ keyCode }) => {\n\t\tif (pause || gameOver)\n\t\t\treturn;\n\t\tswitch (keyCode) {\n\t\t\tcase 37:\n\t\t\t\tsetPlayer(player => ({ ...player, pos: getNewPlayerPos(\"left\") }));\n\t\t\t\tbreak;\n\t\t\tcase 38:\n\t\t\t\trotatePlayer();\n\t\t\t\tbreak;\n\t\t\tcase 39:\n\t\t\t\tsetPlayer(player => ({ ...player, pos: getNewPlayerPos(\"right\") }));\n\t\t\t\tbreak;\n\t\t\tcase 40:\n\t\t\t\tsetTick(Date.now());\n\t\t\t\tsetDown(true);\n\t\t\t\tbreak;\n\t\t\tcase 32:\n\t\t\t\tif (spaceReleased) {\n\t\t\t\t\tsetSpaceReleased(false);\n\t\t\t\t\tforwardDown();\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\t};\n\n\tconst checkMap = React.useCallback(\n\t\tmap => {\n\t\t\tlet rowsClear = [];\n\t\t\tmap.forEach((row, y) => {\n\t\t\t\tlet clear = true;\n\t\t\t\trow.forEach((pixel, x) => {\n\t\t\t\t\tif (pixel.fill === 0) clear = false;\n\t\t\t\t});\n\t\t\t\tif (clear) rowsClear.push(y);\n\t\t\t});\n\t\t\tif (rowsClear.length > 0) {\n\t\t\t\tlet newMap = map.slice();\n\t\t\t\trowsClear.forEach(y => {\n\t\t\t\t\tfor (let mapY = newMap.length - 1; mapY >= 0; mapY--)\n\t\t\t\t\t\tif (mapY <= y)\n\t\t\t\t\t\t\tif (mapY > 0) newMap[mapY] = newMap[mapY - 1];\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\tnewMap[mapY] = [...new Array(STAGE_WIDTH)].map(() => ({\n\t\t\t\t\t\t\t\t\tfill: 0,\n\t\t\t\t\t\t\t\t\tcolor: []\n\t\t\t\t\t\t\t\t}));\n\t\t\t\t});\n\t\t\t\tsetlines(quant => quant + rowsClear.length);\n\t\t\t\tconst bonusLevel = 100 * (level * level);\n\t\t\t\tconst bonusRows = 40 * (rowsClear.length * rowsClear.length - 1);\n\t\t\t\tsetScore(score => score + 300 * rowsClear.length + bonusRows + bonusLevel);\n\t\t\t\treturn newMap;\n\t\t\t}\n\t\t\treturn map;\n\t\t},\n\t\t[level]\n\t);\n\n\tconst validatePosition = React.useCallback(\n\t\t(pos, bloco) => {\n\t\t\tfor (let y = 0; y < bloco.bloco.length; y++)\n\t\t\t\tfor (let x = 0; x < bloco.bloco[y].length; x++)\n\t\t\t\t\tif (bloco.bloco[y][x] === 1) {\n\t\t\t\t\t\tlet mapY = pos[0] + y;\n\t\t\t\t\t\tlet mapX = pos[1] + x;\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tmapY > STAGE_HEIGHT ||\n\t\t\t\t\t\t\tmapX < 0 ||\n\t\t\t\t\t\t\tmapX > STAGE_WIDTH ||\n\t\t\t\t\t\t\t!map[mapY] ||\n\t\t\t\t\t\t\t!map[mapY][mapX] ||\n\t\t\t\t\t\t\tmap[mapY][mapX].fill === 1\n\t\t\t\t\t\t)\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\treturn true;\n\t\t},\n\t\t[map]\n\t);\n\n\tconst calculateHintPlayer = React.useCallback(\n\t\tplayer => {\n\t\t\tconst hintBloco = JSON.parse(JSON.stringify(player.bloco));\n\t\t\tlet hintPosition = [...player.pos];\n\t\t\twhile (validatePosition([hintPosition[0] + 1, hintPosition[1]], hintBloco))\n\t\t\t\thintPosition = [hintPosition[0] + 1, hintPosition[1]];\n\t\t\treturn { pos: hintPosition, bloco: hintBloco };\n\t\t},\n\t\t[validatePosition]\n\t);\n\n\tconst getNewPlayerPos = React.useCallback(\n\t\tmovement => {\n\t\t\tlet newPos;\n\t\t\tif (!player) return;\n\t\t\tif (movement === \"down\") newPos = [player.pos[0] + 1, player.pos[1]];\n\t\t\tif (movement === \"left\") newPos = [player.pos[0], player.pos[1] - 1];\n\t\t\tif (movement === \"right\") newPos = [player.pos[0], player.pos[1] + 1];\n\t\t\tif (!validatePosition(newPos, player.bloco)) return player.pos;\n\t\t\treturn newPos;\n\t\t},\n\t\t[player, validatePosition]\n\t);\n\n\tuseInterval(\n\t\t() => {\n\t\t\tdrop();\n\t\t},\n\t\t(pause || gameOver) ? null : down ? 50 : 450 - (level - 1) * 20\n\t);\n\n\tuseEffect(() => {\n\t\tif (!player) return;\n\t\tsetHintPlayer(calculateHintPlayer(player));\n\t}, [player, calculateHintPlayer]);\n\n\tconst bind = useDrag(\n\t\t({ down, movement: [mx, my], velocity }) => {\n\t\t\tconst THRESHOLD = 20;\n\t\t\tconst FORCE_THRESHOLD = 1;\n\t\t\tif (down) {\n\t\t\t\tif (Math.abs(mx - dragX) > THRESHOLD) {\n\t\t\t\t\tif (mx - dragX > 0)\n\t\t\t\t\t\tsetPlayer(player => ({ ...player, pos: getNewPlayerPos(\"right\") }));\n\t\t\t\t\telse setPlayer(player => ({ ...player, pos: getNewPlayerPos(\"left\") }));\n\t\t\t\t\tsetDragX(mx);\n\t\t\t\t}\n\t\t\t\tif (Math.abs(my - dragY) > THRESHOLD) {\n\t\t\t\t\tif (velocity > FORCE_THRESHOLD) {\n\t\t\t\t\t\tif (spaceReleased) {\n\t\t\t\t\t\t\tsetSpaceReleased(false);\n\t\t\t\t\t\t\tforwardDown();\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (my - dragY > 0) drop();\n\t\t\t\t\tsetDragY(my);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tsetDragX(0);\n\t\t\t\tsetDragY(0);\n\t\t\t\tsetSpaceReleased(true);\n\t\t\t}\n\t\t},\n\t\t{ filterTaps: true, lockDirection: true }\n\t);\n\n\tif (!player || !map || !hintPlayer)\n\t\treturn (\n\t\t\t<Center>\n\t\t\t\t<BarLoader color={\"#C41212\"} />\n\t\t\t</Center>\n\t\t);\n\treturn (\n\t\t<Stage\n\t\t\tlose={gameOver}\n\t\t\trestartClick={() => restartGame()}\n\t\t\tmap={map}\n\t\t\tplayer={player}\n\t\t\thint={hintPlayer}\n\t\t\tpaused={pause}\n\t\t\tstatus={{ lines, score, level }}\n\t\t\tonBlur={() => setPause(true)}\n\t\t\tonFocus={() => setPause(false)}\n\t\t\ttabIndex=\"0\"\n\t\t\tonKeyUp={keyUp}\n\t\t\tonKeyDown={keyDown}\n\t\t\tonClick={() => rotatePlayer()}\n\t\t\t{...bind()}\n\t\t/>\n\t);\n};\n\nexport default Game;\n"]},"metadata":{},"sourceType":"module"}